
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      String   @default("MEMBER") // ADMIN, PASTOR, STAFF, MEMBER
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Link to a specific member profile if this user represents a member
  memberId  Int?     @unique
  member    Member?  @relation(fields: [memberId], references: [id])

  announcements Announcement[] 
  notifications Notification[]
  deviceTokens  DeviceToken[]
}

model DeviceToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  platform  String   // ANDROID, IOS, WEB
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Member {
  id           Int      @id @default(autoincrement())
  name         String
  email        String?  // Contact email
  phone        String?
  profileImage String?
  familyRole   String?
  dob          DateTime? // Date of Birth
  gender       String?   // MALE, FEMALE, OTHER
  headOfFamily Boolean  @default(false)
  status       String   @default("ACTIVE")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  familyId    Int?
  family      Family?      @relation(fields: [familyId], references: [id])
  
  user        User?

  sacraments  Sacrament[]
  ministries  MinistryMember[]
  registrations Registration[]
  requests     PrayerRequest[]
}

model Family {
  id        Int      @id @default(autoincrement())
  name      String
  address   String?
  phone     String?
  createdAt DateTime @default(now())
  members   Member[]
  houseName String?
  
  // Self-relation for related families
  relatedTo Family[] @relation("FamilyRelations")
  relatedBy Family[] @relation("FamilyRelations")
}

model Sacrament {
  id        Int      @id @default(autoincrement())
  type      String   // BAPTISM, CONFIRMATION, MARRIAGE, etc.
  date      DateTime
  details   String?
  memberId  Int
  member    Member   @relation(fields: [memberId], references: [id])
}

model Ministry {
  id        Int      @id @default(autoincrement())
  name      String
  description String?
  meetingSchedule String? // e.g. "Every Sunday 10 AM"
  members   MinistryMember[]
}

model MinistryMember {
  id         Int      @id @default(autoincrement())
  ministryId Int
  ministry   Ministry @relation(fields: [ministryId], references: [id])
  memberId   Int
  member     Member   @relation(fields: [memberId], references: [id])
  role       String   @default("MEMBER") // LEADER, MEMBER
}

model Event {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  type        String   @default("EVENT") // SERVICE, EVENT
  date        DateTime
  location    String?
  isLive      Boolean  @default(false)
  liveUrl     String?
  status      String   @default("DRAFT") // DRAFT, PUBLISHED
  isFeatured  Boolean  @default(false)
  registrations Registration[]
}

model Registration {
  id        Int      @id @default(autoincrement())
  eventId   Int
  event     Event    @relation(fields: [eventId], references: [id])
  memberId  Int
  member    Member   @relation(fields: [memberId], references: [id])
  status    String   @default("REGISTERED")
  createdAt DateTime @default(now())
}

model Announcement {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  createdAt DateTime @default(now())
  authorId  Int
  author    User     @relation(fields: [authorId], references: [id])
}

model Content {
  id        Int      @id @default(autoincrement())
  type      String   // DEVOTION, BIBLE_VERSE, GALLERY
  title     String
  body      String?
  mediaUrl  String?
  date      DateTime @default(now())
}

model PrayerRequest {
  id        Int      @id @default(autoincrement())
  memberId  Int
  member    Member   @relation(fields: [memberId], references: [id])
  request   String
  status    String   @default("PENDING") // PENDING, ACKNOWLEDGED
  createdAt DateTime @default(now())
}

model ChurchSettings {
  id          Int      @id @default(autoincrement())
  churchName  String
  address     String?
  phone       String?
  email       String?
  website     String?
  logoUrl     String?
  description String?
  firebaseConfig String?  @db.Text // Store Firebase Service Account JSON
  updatedAt   DateTime @updatedAt
}

model GalleryCategory {
  id        Int      @id @default(autoincrement())
  name      String
  albums    GalleryAlbum[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model GalleryAlbum {
  id           Int      @id @default(autoincrement())
  title        String
  description  String?
  coverImage   String?
  date         DateTime @default(now())
  categoryId   Int
  category     GalleryCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  images       GalleryImage[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model GalleryImage {
  id        Int      @id @default(autoincrement())
  url       String
  caption   String?
  albumId   Int
  album     GalleryAlbum @relation(fields: [albumId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model Notification {
  id        Int      @id @default(autoincrement())
  title     String
  body      String
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  isRead    Boolean  @default(false)
  type      String   @default("GENERAL") // GENERAL, EVENT, SACRAMENT
  data      String?  // JSON string for extra data (e.g. eventId)
  createdAt DateTime @default(now())
}

model NotificationHistory {
  id        Int      @id @default(autoincrement())
  title     String
  body      String
  type      String   @default("BROADCAST") // BROADCAST, UNICAST
  data      String?
  sentAt    DateTime @default(now())
  sentBy    Int?     // Optional: ID of admin who sent it
  status    String   @default("SENT") // SENT, DRAFT
}
